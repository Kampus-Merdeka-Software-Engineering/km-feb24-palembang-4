<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navigasi">
        <header>
            <div class="image-text">
                <span class="image">
                    <img src="assets/revou_logo.jpeg" alt="">
                </span>

                <div class="text">
                    <span class="title">VENDING MACHINE REPORT</span>
                    <span class="team">Team 4 Palembang</span>
                </div>
            </div>

            <div class="filter">
            </div>
        </header>
    </nav>

    <section class="wrapper">
        <div class="row">
            <div class="card">
                <div class="insight">
                    <span id="point">TOTAL TRANSACTION</span>
                    <span id="number">0</span>
                    <span id="increase"><img src="assets/arrow-upward.png" alt=""> 20,5% From Previous 1 Month</span>
                </div>

                <div class="properties">
                    <img src="assets/ikon4.jpeg" alt="">
                </div>
            </div>

            <div class="card">
                <div class="insight">
                    <span id="point">TOTAL SALES</span>
                    <span id="number">$ 184045.25</span>
                    <span id="decrease"><img src="assets/down-arrow.png" alt=""> 20,5% From Previous 1 Month</span>
                </div>

                <div class="properties">
                    <img src="assets/ikon1.jpeg" alt="">
                </div>
            </div>

            <div class="card">
                <div class="insight">
                    <span id="point">QUANTITY SALES</span>
                    <span id="number">9,393</span>
                    <span id="increase"><img src="assets/arrow-upward.png" alt=""> 20,5% From Previous 1 Month</span>
                </div>

                <div class="properties">
                    <img src="assets/ikon2.jpeg" alt="">
                </div>
            </div>

            <div class="card">
                <div class="insight">
                    <span id="point">TOTAL PRODUCS</span>
                    <span id="number">174</span>
                    <span id="increase">All types of producs have been sold</span>
                </div>

                <div class="properties">
                    <img src="assets/ikon3.jpeg" alt="">
                </div>
            </div>

        </div>
    </section>

    <div class="chart">
        <div class="container">
            <div class="column left">
                <canvas class="columnChart"></canvas>
            </div>
            <div class="column right">
                <canvas class="doughnutChart"></canvas>
            </div>
        </div>
    
        <div class="containers">
            <div class="column left">
                <h1 style="color: #5B86E5;">TRANSACTION FROM LOCATION</h1>
                <div class="select-wrapper">
                    <select id="locationSelector" onchange="updateChart()">
                        <option value="All">All Locations</option>
                        <option value="GuttenPlans">GuttenPlans</option>
                        <option value="EB Public Library">EB Public Library</option>
                        <option value="Earle Asphalt">Earle Asphalt</option>
                        <option value="Brunswick Sq Mall">Brunswick Sq Mall</option>
                        <!-- Tambahkan opsi lain sesuai kebutuhan -->
                    </select>
                </div>
                <canvas id="myChart"></canvas>
            </div>
            <div class="column right">
                <canvas class="lineChart"></canvas>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        let myChart;
        let jsonData;

        // Ambil data JSON saat halaman dimuat pertama kali
        fetch('transaksi.json')
            .then(response => response.json())
            .then(data => {
                jsonData = data;

                // Hitung total transaksi
                const totalTransaction = jsonData.reduce((sum, item) => sum + item.Transaction, 0);

                // Tampilkan total transaksi di elemen dengan id 'number'
                document.getElementById('number').innerText = totalTransaction;

                // Panggil fungsi updateChart untuk menampilkan grafik
                updateChart();
            });

        function updateChart() {
            const selectedLocation = document.getElementById('locationSelector').value;

            // Filter data berdasarkan lokasi yang dipilih atau tampilkan semua data jika 'All Locations' dipilih
            const filteredData = selectedLocation === "All" ? jsonData : jsonData.filter(item => item.Location === selectedLocation);

            // Mendapatkan label dan data dari JSON yang telah difilter
            const labels = filteredData.map(item => item.Location);
            const dataValues = filteredData.map(item => item.Transaction);

            // Jika grafik sudah ada, perbarui datanya
            if (myChart) {
                myChart.data.labels = labels;
                myChart.data.datasets[0].data = dataValues;
                myChart.update();
            } else {
                // Konfigurasi grafik
                const config = {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Total Transaksi',
                            data: dataValues,
                            backgroundColor: 'rgba(0, 91, 191, 1)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        scales: {
                            x: {
                                beginAtZero: true
                            }
                        }
                    }
                };

                // Membuat grafik menggunakan konfigurasi
                const ctx = document.getElementById('myChart').getContext('2d');
                myChart = new Chart(ctx, config);
            }
        }

        // Panggil fungsi updateChart saat halaman dimuat pertama kali
        window.onload = updateChart;
    </script>

</body>
</html>